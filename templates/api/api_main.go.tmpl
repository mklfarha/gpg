package main

import (
	"go.uber.org/fx"
	"go.uber.org/zap"
	{{.Identifier}}config "{{.Identifier}}/config"
	"{{.Identifier}}/core"
	{{ if eq .Protocol "protobuf"}}
	pbserver "{{.Identifier}}/idl/server"		
	{{end}}
	{{ if eq .Auth.Enabled true}}
	"{{.Identifier}}/auth"
    {{ end }}
	{{if eq .Protocol "graphql"}}
	"{{.Identifier}}/graph"
	{{end}}
)

func main() {
	fx.New(
		fx.Provide(
			zap.NewProduction,
			{{.Identifier}}config.New,
			core.New,	
			{{if eq .Auth.Enabled true}}auth.New,{{end}}	
			{{if eq .Protocol "graphql"}}graph.New,{{end}}
		),				
		fx.Invoke(httpServer),
		{{ if eq .Protocol "protobuf" }}
		fx.Invoke(pbserver.New),
		{{end}}
	).Run()
}

